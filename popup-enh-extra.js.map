{"version":3,"file":"popup-enh-extra.js","sources":["../src/popup-enh-extra.ts"],"sourcesContent":["import {AnyState, makeMovable, makeResizable, MovableOpts, ResizableOpts} from \"./popup-enh-core.js\";\n\n\ntype StoreStateOpt<T extends AnyState, S extends string> = {\n    id: S extends \"\" ? never : S,\n    onMove?: (state: T) => void,\n    onStop?: (state: T) => void,\n};\n\ntype StoreStateReturn<T extends AnyState> = {\n    onMove?: (state: T) => void,\n    onStop?: (state: T) => void,\n    state?: T,\n    reset: () => void,\n};\n\nexport function storeStateInLS<T extends AnyState, S extends string>(\n    {id: lsName, onMove, onStop}: StoreStateOpt<T, S>\n): StoreStateReturn<T> {\n    const stateJson = localStorage.getItem(lsName);\n    let state;\n    if (stateJson) {\n        state = JSON.parse(stateJson);\n    }\n\n    const save = (state: T) => localStorage.setItem(lsName, JSON.stringify(state));\n    const reset = () => localStorage.removeItem(lsName);\n\n    let _onStop;\n    if (onStop) {\n        _onStop = function(state: T) {\n            onStop(state);\n            save(state);\n        };\n    } else {\n        _onStop = save;\n    }\n\n    return {onMove, onStop: _onStop, state, reset};\n}\n\nexport function getPopupEnh<S extends string>(appName: S extends \"\" ? never : S) {\n    return {\n        /**\n         * Use `position: \"relative\"` option if you want to open multiple popups at once,\n         * and you do not want they overlap each other. However, don't use it with resizable popups.\n         */\n        makeMovableEx<S extends string>(element: HTMLElement, id: S extends \"\" ? never : S, opt: MovableOpts = {}) {\n            return makeMovable(element, {\n                ...opt,\n                ...storeStateInLS({\n                    id: `${appName as string}--${id as string}--move-state`,\n                    ...opt,\n                })\n            });\n        },\n        makeResizableEx<S extends string>(element: HTMLElement, id: S extends \"\" ? never : S, opt: ResizableOpts = {}) {\n            return makeResizable(element, {\n                ...opt,\n                ...storeStateInLS({\n                    id: `${appName as string}--${id as string}--resize-state`,\n                    ...opt,\n                })\n            });\n        },\n    }\n}\n\n/**\n * Makes the element focusable, adds `\"focus\"` class.\n * Specify the drag `handle` (if exists) to run `\"focus\"` listener callback on `\"pointerdown\"` on it.\n */\nexport function makeFocusable(element: HTMLElement, handle?: HTMLElement) {\n    element.setAttribute(\"tabindex\", \"-1\");\n    element.addEventListener(\"focusin\", focusin);\n    element.addEventListener(\"focusout\", focusout);\n    let blurTimerId = 0;\n    function focusin() {\n        element.classList.add(\"focus\");\n        clearTimeout(blurTimerId);\n    }\n    function focusout() {\n        blurTimerId = window.setTimeout(() => {\n            element.classList.remove(\"focus\");\n        }, 250);\n    }\n    (handle || element).addEventListener(\"pointerdown\", event => {\n        element.focus();\n    }, {passive: true});\n}\n"],"names":["state"],"mappings":";AAgBO,SAAS,eACZ,EAAC,IAAI,QAAQ,QAAQ,UACF;AACb,QAAA,YAAY,aAAa,QAAQ,MAAM;AACzC,MAAA;AACJ,MAAI,WAAW;AACH,YAAA,KAAK,MAAM,SAAS;AAAA,EAChC;AAEM,QAAA,OAAO,CAACA,WAAa,aAAa,QAAQ,QAAQ,KAAK,UAAUA,MAAK,CAAC;AAC7E,QAAM,QAAQ,MAAM,aAAa,WAAW,MAAM;AAE9C,MAAA;AACJ,MAAI,QAAQ;AACR,cAAU,SAASA,QAAU;AACzB,aAAOA,MAAK;AACZ,WAAKA,MAAK;AAAA,IAAA;AAAA,EACd,OACG;AACO,cAAA;AAAA,EACd;AAEA,SAAO,EAAC,QAAQ,QAAQ,SAAS,OAAO,MAAK;AACjD;AAEO,SAAS,YAA8B,SAAmC;AACtE,SAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAKH,cAAgC,SAAsB,IAA8B,MAAmB,CAAA,GAAI;AACvG,aAAO,YAAY,SAAS;AAAA,QACxB,GAAG;AAAA,QACH,GAAG,eAAe;AAAA,UACd,IAAI,GAAG,OAAiB,KAAK,EAAY;AAAA,UACzC,GAAG;AAAA,QAAA,CACN;AAAA,MAAA,CACJ;AAAA,IACL;AAAA,IACA,gBAAkC,SAAsB,IAA8B,MAAqB,CAAA,GAAI;AAC3G,aAAO,cAAc,SAAS;AAAA,QAC1B,GAAG;AAAA,QACH,GAAG,eAAe;AAAA,UACd,IAAI,GAAG,OAAiB,KAAK,EAAY;AAAA,UACzC,GAAG;AAAA,QAAA,CACN;AAAA,MAAA,CACJ;AAAA,IACL;AAAA,EAAA;AAER;AAMgB,SAAA,cAAc,SAAsB,QAAsB;AAC9D,UAAA,aAAa,YAAY,IAAI;AAC7B,UAAA,iBAAiB,WAAW,OAAO;AACnC,UAAA,iBAAiB,YAAY,QAAQ;AAC7C,MAAI,cAAc;AAClB,WAAS,UAAU;AACP,YAAA,UAAU,IAAI,OAAO;AAC7B,iBAAa,WAAW;AAAA,EAC5B;AACA,WAAS,WAAW;AACF,kBAAA,OAAO,WAAW,MAAM;AAC1B,cAAA,UAAU,OAAO,OAAO;AAAA,OACjC,GAAG;AAAA,EACV;AACA,GAAC,UAAU,SAAS,iBAAiB,eAAe,CAAS,UAAA;AACzD,YAAQ,MAAM;AAAA,EAAA,GACf,EAAC,SAAS,KAAA,CAAK;AACtB;"}